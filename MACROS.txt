Function EST_AVG_CC_DIST(geo_distances As Range, latitude As Long, longitude As Long, lats As Range, longs As Range)Dim N As LongN = 1EST_AVG_CC_DIST = 0For Each cell In geo_distances    If cell.Value > 0 Then        EST_AVG_CC_DIST = EST_AVG_CC_DIST + DISTANCE(latitude, longitude, lats.Cells(N, 1).Value, longs.Cells(N, 1).Value)    End If    N = N + 1Next cell    EST_AVG_CC_DIST = EST_AVG_CC_DIST / 19End Function------------------------------------------------------------------------------------

Function DISTANCE(lat1, long1, lat2, long2)    DISTANCE = Application.WorksheetFunction.Acos(Cos(Application.WorksheetFunction.Radians(90 - lat1)) * Cos(Application.WorksheetFunction.Radians(90 - lat2)) + Sin(Application.WorksheetFunction.Radians(90 - lat1)) * Sin(Application.WorksheetFunction.Radians(90 - lat2)) * Cos(Application.WorksheetFunction.Radians(long1 - long2))) * 3958.756End Function